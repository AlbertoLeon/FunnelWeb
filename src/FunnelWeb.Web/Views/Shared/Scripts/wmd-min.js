var Attacklab=Attacklab||{};Attacklab.wmdBase=function(){var m=top.Attacklab;var d=top.document;var l=top.RegExp;var b=top.navigator;m.Util={};m.Position={};m.Command={};m.Global={};var j=m.Util;var p=m.Position;var c=m.Command;var a=m.Global;a.isIE=/msie/.test(b.userAgent.toLowerCase());a.isIE_5or6=/msie 6/.test(b.userAgent.toLowerCase())||/msie 5/.test(b.userAgent.toLowerCase());a.isIE_7plus=a.isIE&&!a.isIE_5or6;a.isOpera=/opera/.test(b.userAgent.toLowerCase());a.isKonqueror=/konqueror/.test(b.userAgent.toLowerCase());var i="<p style='margin-top: 0px'><b>Enter the image URL.</b></p><p>You can also add a title, which will be displayed as a tool tip.</p><p>Example:<br />http://wmd-editor.com/images/cloud1.jpg   \"Optional title\"</p>";var q="<p style='margin-top: 0px'><b>Enter the web address.</b></p><p>You can also use the name of the page for inter-page links.</p><p>Example:<br /><ul><li>http://foo.com/bar</li><li>my-page</li></ul></p>";var e="";var k="";var n="/Views/Shared/Images/";var h=500;var f=100;var g="http://wmd-editor.com/";var o="WMD website";var r="_blank";m.PanelCollection=function(){this.buttonBar=d.getElementById("wmd-button-bar");this.preview=d.getElementById("wmd-preview");this.output=d.getElementById("wmd-output");this.input=d.getElementById("wmd-input")};m.panels=undefined;m.ieCachedRange=null;m.ieRetardedClick=false;j.isVisible=function(s){if(window.getComputedStyle){return window.getComputedStyle(s,null).getPropertyValue("display")!=="none"}else{if(s.currentStyle){return s.currentStyle.display!=="none"}}};j.addEvent=function(u,t,s){if(u!=null&&u.attachEvent){u.attachEvent("on"+t,s)}else{if(u!=null){u.addEventListener(t,s,false)}}};j.removeEvent=function(u,t,s){if(u.detachEvent){u.detachEvent("on"+t,s)}else{u.removeEventListener(t,s,false)}};j.fixEolChars=function(s){s=s.replace(/\r\n/g,"\n");s=s.replace(/\r/g,"\n");return s};j.extendRegExp=function(u,w,t){if(w===null||w===undefined){w=""}if(t===null||t===undefined){t=""}var v=u.toString();var s;v=v.replace(/\/([gim]*)$/,"");s=l.$1;v=v.replace(/(^\/|\/$)/g,"");v=w+v+t;return new l(v,s)};j.createImage=function(t){var s=n+t;var u=d.createElement("img");u.className="wmd-button";u.src=s;return u};j.prompt=function(B,y,v){var x;var z;var w;if(y===undefined){y=""}var u=function(C){var D=(C.charCode||C.keyCode);if(D===27){s(true)}};var s=function(C){j.removeEvent(d.body,"keydown",u);var D=w.value;if(C){D=null}else{D=D.replace("http://http://","http://");D=D.replace("http://https://","https://");D=D.replace("http://ftp://","ftp://");if(D.indexOf("http://")===-1&&D.indexOf("ftp://")===-1&&D.indexOf("https://")===-1){}}x.parentNode.removeChild(x);z.parentNode.removeChild(z);v(D);return false};var A=function(){z=d.createElement("div");z.className="wmd-prompt-background";style=z.style;style.position="absolute";style.top="0";style.zIndex="1000";if(a.isKonqueror){style.backgroundColor="transparent"}else{if(a.isIE){style.filter="alpha(opacity=50)"}else{style.opacity="0.5"}}var C=p.getPageSize();style.height=C[1]+"px";if(a.isIE){style.left=d.documentElement.scrollLeft;style.width=d.documentElement.clientWidth}else{style.left="0";style.width="100%"}d.body.appendChild(z)};var t=function(){x=d.createElement("div");x.className="wmd-prompt-dialog";x.style.padding="10px;";x.style.position="fixed";x.style.width="400px";x.style.zIndex="1001";var E=d.createElement("div");E.innerHTML=B;E.style.padding="5px";x.appendChild(E);var C=d.createElement("form");C.onsubmit=function(){return s(false)};style=C.style;style.padding="0";style.margin="0";style.cssFloat="left";style.width="100%";style.textAlign="center";style.position="relative";x.appendChild(C);w=d.createElement("input");w.type="text";w.value=y;style=w.style;style.display="block";style.width="80%";style.marginLeft=style.marginRight="auto";C.appendChild(w);var F=d.createElement("input");F.type="button";F.onclick=function(){return s(false)};F.value="OK";style=F.style;style.margin="10px";style.display="inline";style.width="7em";var D=d.createElement("input");D.type="button";D.onclick=function(){return s(true)};D.value="Cancel";style=D.style;style.margin="10px";style.display="inline";style.width="7em";if(/mac/.test(b.platform.toLowerCase())){C.appendChild(D);C.appendChild(F)}else{C.appendChild(F);C.appendChild(D)}j.addEvent(d.body,"keydown",u);x.style.top="50%";x.style.left="50%";x.style.display="block";if(a.isIE_5or6){x.style.position="absolute";x.style.top=d.documentElement.scrollTop+200+"px";x.style.left="50%"}d.body.appendChild(x);x.style.marginTop=-(p.getHeight(x)/2)+"px";x.style.marginLeft=-(p.getWidth(x)/2)+"px"};A();top.setTimeout(function(){t();var D=y.length;if(w.selectionStart!==undefined){w.selectionStart=0;w.selectionEnd=D}else{if(w.createTextRange){var C=w.createTextRange();C.collapse(false);C.moveStart("character",-D);C.moveEnd("character",D);C.select()}}w.focus()},0)};p.getTop=function(t,u){var s=t.offsetTop;if(!u){while(t=t.offsetParent){s+=t.offsetTop}}return s};p.getHeight=function(s){return s.offsetHeight||s.scrollHeight};p.getWidth=function(s){return s.offsetWidth||s.scrollWidth};p.getPageSize=function(){var u,v;var w,s;if(self.innerHeight&&self.scrollMaxY){u=d.body.scrollWidth;v=self.innerHeight+self.scrollMaxY}else{if(d.body.scrollHeight>d.body.offsetHeight){u=d.body.scrollWidth;v=d.body.scrollHeight}else{u=d.body.offsetWidth;v=d.body.offsetHeight}}if(self.innerHeight){w=self.innerWidth;s=self.innerHeight}else{if(d.documentElement&&d.documentElement.clientHeight){w=d.documentElement.clientWidth;s=d.documentElement.clientHeight}else{if(d.body){w=d.body.clientWidth;s=d.body.clientHeight}}}var x=Math.max(u,w);var t=Math.max(v,s);return[x,t,w,s]};m.inputPoller=function(u,B){var s=this;var y=m.panels.input;var z;var A;var w;var x;this.tick=function(){if(!j.isVisible(y)){return}if(y.selectionStart||y.selectionStart===0){var D=y.selectionStart;var C=y.selectionEnd;if(D!=z||C!=A){z=D;A=C;if(w!=y.value){w=y.value;return true}}}return false};var v=function(){if(!j.isVisible(y)){return}if(s.tick()){u()}};var t=function(){x=top.setInterval(v,B)};this.destroy=function(){top.clearInterval(x)};t()};m.undoManager=function(v){var u=this;var y=[];var z=0;var s="none";var C;var A;var F;var D;var G=function(J,I){if(s!=J){s=J;if(!I){E()}}if(!a.isIE||s!="moving"){F=top.setTimeout(H,1)}else{D=null}};var H=function(){D=new m.TextareaState();A.tick();F=undefined};this.setCommandMode=function(){s="command";E();F=top.setTimeout(H,0)};this.canUndo=function(){return z>1};this.canRedo=function(){if(y[z+1]){return true}return false};this.undo=function(){if(u.canUndo()){if(C){C.restore();C=null}else{y[z]=new m.TextareaState();y[--z].restore();if(v){v()}}}s="none";m.panels.input.focus();H()};this.redo=function(){if(u.canRedo()){y[++z].restore();if(v){v()}}s="none";m.panels.input.focus();H()};var E=function(){var I=D||new m.TextareaState();if(!I){return false}if(s=="moving"){if(!C){C=I}return}if(C){if(y[z-1].text!=C.text){y[z++]=C}C=null}y[z++]=I;y[z+1]=null;if(v){v()}};var w=function(J){var L=false;if(J.ctrlKey||J.metaKey){var K=J.charCode||J.keyCode;var I=String.fromCharCode(K);switch(I){case"y":u.redo();L=true;break;case"z":if(!J.shiftKey){u.undo()}else{u.redo()}L=true;break}}if(L){if(J.preventDefault){J.preventDefault()}if(top.event){top.event.returnValue=false}return}};var t=function(J){if(!J.ctrlKey&&!J.metaKey){var I=J.keyCode;if((I>=33&&I<=40)||(I>=63232&&I<=63235)){G("moving")}else{if(I==8||I==46||I==127){G("deleting")}else{if(I==13){G("newlines")}else{if(I==27){G("escape")}else{if((I<16||I>20)&&I!=91){G("typing")}}}}}}};var B=function(){j.addEvent(m.panels.input,"keypress",function(J){if((J.ctrlKey||J.metaKey)&&(J.keyCode==89||J.keyCode==90)){J.preventDefault()}});var I=function(){if(a.isIE||(D&&D.text!=m.panels.input.value)){if(F==undefined){s="paste";E();H()}}};A=new m.inputPoller(I,f);j.addEvent(m.panels.input,"keydown",w);j.addEvent(m.panels.input,"keydown",t);j.addEvent(m.panels.input,"mousedown",function(){G("moving")});m.panels.input.onpaste=I;m.panels.input.ondrop=I};var x=function(){B();H();E()};this.destroy=function(){if(A){A.destroy()}};x()};m.editor=function(E){if(!E){E=function(){}}var w=m.panels.input;var z=0;var u=this;var F;var D;var t;var y;var B;var v=function(I){w.focus();if(I.textOp){if(B){B.setCommandMode()}var M=new m.TextareaState();if(!M){return}var L=M.getChunks();var K=function(){w.focus();if(L){M.setChunks(L)}M.restore();E()};var J=I.textOp(L,K);if(!J){K()}}if(I.execute){I.execute(u)}};var H=function(){if(B){s(document.getElementById("wmd-undo-button"),B.canUndo());s(document.getElementById("wmd-redo-button"),B.canRedo())}};var s=function(I,K){var M="0px";var L="-20px";var J="-40px";if(K){I.style.backgroundPosition=I.XShift+" "+M;I.onmouseover=function(){this.style.backgroundPosition=this.XShift+" "+J};I.onmouseout=function(){this.style.backgroundPosition=this.XShift+" "+M};if(a.isIE){I.onmousedown=function(){m.ieRetardedClick=true;m.ieCachedRange=document.selection.createRange()}}if(!I.isHelp){I.onclick=function(){if(this.onmouseout){this.onmouseout()}v(this);return false}}}else{I.style.backgroundPosition=I.XShift+" "+L;I.onmouseover=I.onmouseout=I.onclick=function(){}}};var x=function(){var W=document.getElementById("wmd-button-bar");var ac="0px";var O="-20px";var Y="-40px";var I=document.createElement("ul");I.id="wmd-button-row";I=W.appendChild(I);var ab=document.createElement("li");ab.className="wmd-button";ab.id="wmd-bold-button";ab.title="Strong <strong> Ctrl+B";ab.XShift="0px";ab.textOp=c.doBold;s(ab,true);I.appendChild(ab);var L=document.createElement("li");L.className="wmd-button";L.id="wmd-italic-button";L.title="Emphasis <em> Ctrl+I";L.XShift="-20px";L.textOp=c.doItalic;s(L,true);I.appendChild(L);var aa=document.createElement("li");aa.className="wmd-spacer";aa.id="wmd-spacer1";I.appendChild(aa);var U=document.createElement("li");U.className="wmd-button";U.id="wmd-link-button";U.title="Hyperlink <a> Ctrl+L";U.XShift="-40px";U.textOp=function(af,ae){return c.doLinkOrImage(af,ae,false)};s(U,true);I.appendChild(U);var X=document.createElement("li");X.className="wmd-button";X.id="wmd-quote-button";X.title="Blockquote <blockquote> Ctrl+Q";X.XShift="-60px";X.textOp=c.doBlockquote;s(X,true);I.appendChild(X);var V=document.createElement("li");V.className="wmd-button";V.id="wmd-code-button";V.title="Code Sample <pre><code> Ctrl+K";V.XShift="-80px";V.textOp=c.doCode;s(V,true);I.appendChild(V);var J=document.createElement("li");J.className="wmd-button";J.id="wmd-image-button";J.title="Image <img> Ctrl+G";J.XShift="-100px";J.textOp=function(af,ae){return c.doLinkOrImage(af,ae,true)};s(J,true);I.appendChild(J);var S=document.createElement("li");S.className="wmd-spacer";S.id="wmd-spacer2";I.appendChild(S);var N=document.createElement("li");N.className="wmd-button";N.id="wmd-olist-button";N.title="Numbered List <ol> Ctrl+O";N.XShift="-120px";N.textOp=function(af,ae){c.doList(af,ae,true)};s(N,true);I.appendChild(N);var K=document.createElement("li");K.className="wmd-button";K.id="wmd-ulist-button";K.title="Bulleted List <ul> Ctrl+U";K.XShift="-140px";K.textOp=function(af,ae){c.doList(af,ae,false)};s(K,true);I.appendChild(K);var Q=document.createElement("li");Q.className="wmd-button";Q.id="wmd-heading-button";Q.title="Heading <h1>/<h2> Ctrl+H";Q.XShift="-160px";Q.textOp=c.doHeading;s(Q,true);I.appendChild(Q);var R=document.createElement("li");R.className="wmd-button";R.id="wmd-hr-button";R.title="Horizontal Rule <hr> Ctrl+R";R.XShift="-180px";R.textOp=c.doHorizontalRule;s(R,true);I.appendChild(R);var M=document.createElement("li");M.className="wmd-spacer";M.id="wmd-spacer3";I.appendChild(M);var Z=document.createElement("li");Z.className="wmd-button";Z.id="wmd-undo-button";Z.title="Undo - Ctrl+Z";Z.XShift="-200px";Z.execute=function(ae){ae.undo()};s(Z,true);I.appendChild(Z);var T=document.createElement("li");T.className="wmd-button";T.id="wmd-redo-button";T.title="Redo - Ctrl+Y";if(/win/.test(b.platform.toLowerCase())){T.title="Redo - Ctrl+Y"}else{T.title="Redo - Ctrl+Shift+Z"}T.XShift="-220px";T.execute=function(ae){ae.redo()};s(T,true);I.appendChild(T);var ad=document.createElement("li");ad.className="wmd-button";ad.id="wmd-help-button";ad.XShift="-240px";ad.isHelp=true;var P=document.createElement("a");P.href=g;P.target=r;P.title=o;ad.appendChild(P);s(ad,true);I.appendChild(ad);H()};var G=function(){if(/\?noundo/.test(d.location.href)){m.nativeUndo=true}if(!m.nativeUndo){B=new m.undoManager(function(){E();H()})}x();var I="keydown";if(a.isOpera){I="keypress"}j.addEvent(w,I,function(M){if(M.ctrlKey||M.metaKey){var L=M.charCode||M.keyCode;var K=String.fromCharCode(L).toLowerCase();switch(K){case"b":v(document.getElementById("wmd-bold-button"));break;case"i":v(document.getElementById("wmd-italic-button"));break;case"l":v(document.getElementById("wmd-link-button"));break;case"q":v(document.getElementById("wmd-quote-button"));break;case"k":v(document.getElementById("wmd-code-button"));break;case"g":v(document.getElementById("wmd-image-button"));break;case"o":v(document.getElementById("wmd-olist-button"));break;case"u":v(document.getElementById("wmd-ulist-button"));break;case"h":v(document.getElementById("wmd-heading-button"));break;case"r":v(document.getElementById("wmd-hr-button"));break;case"y":v(document.getElementById("wmd-redo-button"));break;case"z":if(M.shiftKey){v(document.getElementById("wmd-redo-button"))}else{v(document.getElementById("wmd-undo-button"))}break;default:return}if(M.preventDefault){M.preventDefault()}if(top.event){top.event.returnValue=false}}});j.addEvent(w,"keyup",function(K){if(K.shiftKey&&!K.ctrlKey&&!K.metaKey){var L=K.charCode||K.keyCode;if(L===13){fakeButton={};fakeButton.textOp=c.doAutoindent;v(fakeButton)}}});if(a.isIE){j.addEvent(w,"keydown",function(K){var L=K.keyCode;if(L===27){return false}})}if(w.form){var J=w.form.onsubmit;w.form.onsubmit=function(){if(J){return J.apply(this,arguments)}}}};var C=function(){if(m.showdown){var I=new m.showdown.converter()}var K=w.value;var J=function(){w.value=K};if(!/markdown/.test(m.wmd_env.output.toLowerCase())){if(I){w.value=I.makeHtml(K);top.setTimeout(J,0)}}return true};this.undo=function(){if(B){B.undo()}};this.redo=function(){if(B){B.redo()}};var A=function(){G()};this.destroy=function(){if(B){B.destroy()}if(t.parentNode){t.parentNode.removeChild(t)}if(w){w.style.marginTop=""}top.clearInterval(y)};A()};m.TextareaState=function(){var t=this;var s=m.panels.input;this.init=function(){if(!j.isVisible(s)){return}this.setInputAreaSelectionStartEnd();this.scrollTop=s.scrollTop;if(!this.text&&s.selectionStart||s.selectionStart===0){this.text=s.value}};this.setInputAreaSelection=function(){if(!j.isVisible(s)){return}if(s.selectionStart!==undefined&&!a.isOpera){s.focus();s.selectionStart=t.start;s.selectionEnd=t.end;s.scrollTop=t.scrollTop}else{if(d.selection){if(d.activeElement&&d.activeElement!==s){return}s.focus();var u=s.createTextRange();u.moveStart("character",-s.value.length);u.moveEnd("character",-s.value.length);u.moveEnd("character",t.end);u.moveStart("character",t.start);u.select()}}};this.setInputAreaSelectionStartEnd=function(){if(s.selectionStart||s.selectionStart===0){t.start=s.selectionStart;t.end=s.selectionEnd}else{if(d.selection){t.text=j.fixEolChars(s.value);var v;if(m.ieRetardedClick&&m.ieCachedRange){v=m.ieCachedRange;m.ieRetardedClick=false}else{v=d.selection.createRange()}var u=j.fixEolChars(v.text);var x="\x07";var y=x+u+x;v.text=y;var z=j.fixEolChars(s.value);v.moveStart("character",-y.length);v.text=u;t.start=z.indexOf(x);t.end=z.lastIndexOf(x)-x.length;var w=t.text.length-j.fixEolChars(s.value).length;if(w){v.moveStart("character",-u.length);while(w--){u+="\n";t.end+=1}v.text=u}this.setInputAreaSelection()}}};this.restore=function(){if(t.text!=undefined&&t.text!=s.value){s.value=t.text}this.setInputAreaSelection();s.scrollTop=t.scrollTop};this.getChunks=function(){var u=new m.Chunks();u.before=j.fixEolChars(t.text.substring(0,t.start));u.startTag="";u.selection=j.fixEolChars(t.text.substring(t.start,t.end));u.endTag="";u.after=j.fixEolChars(t.text.substring(t.end));u.scrollTop=t.scrollTop;return u};this.setChunks=function(u){u.before=u.before+u.startTag;u.after=u.endTag+u.after;if(a.isOpera){u.before=u.before.replace(/\n/g,"\r\n");u.selection=u.selection.replace(/\n/g,"\r\n");u.after=u.after.replace(/\n/g,"\r\n")}this.start=u.before.length;this.end=u.before.length+u.selection.length;this.text=u.before+u.selection+u.after;this.scrollTop=u.scrollTop};this.init()};m.Chunks=function(){};m.Chunks.prototype.findTags=function(u,s){var t=this;var v;if(u){v=j.extendRegExp(u,"","$");this.before=this.before.replace(v,function(w){t.startTag=t.startTag+w;return""});v=j.extendRegExp(u,"^","");this.selection=this.selection.replace(v,function(w){t.startTag=t.startTag+w;return""})}if(s){v=j.extendRegExp(s,"","$");this.selection=this.selection.replace(v,function(w){t.endTag=w+t.endTag;return""});v=j.extendRegExp(s,"^","");this.after=this.after.replace(v,function(w){t.endTag=w+t.endTag;return""})}};m.Chunks.prototype.trimWhitespace=function(s){this.selection=this.selection.replace(/^(\s*)/,"");if(!s){this.before+=l.$1}this.selection=this.selection.replace(/(\s*)$/,"");if(!s){this.after=l.$1+this.after}};m.Chunks.prototype.skipLines=function(s,t,w){if(s===undefined){s=1}if(t===undefined){t=1}s++;t++;var v;var u;this.selection=this.selection.replace(/(^\n*)/,"");this.startTag=this.startTag+l.$1;this.selection=this.selection.replace(/(\n*$)/,"");this.endTag=this.endTag+l.$1;this.startTag=this.startTag.replace(/(^\n*)/,"");this.before=this.before+l.$1;this.endTag=this.endTag.replace(/(\n*$)/,"");this.after=this.after+l.$1;if(this.before){v=u="";while(s--){v+="\\n?";u+="\n"}if(w){v="\\n*"}this.before=this.before.replace(new l(v+"$",""),u)}if(this.after){v=u="";while(t--){v+="\\n?";u+="\n"}if(w){v="\\n*"}this.after=this.after.replace(new l(v,""),u)}};c.prefixes="(?:\\s{4,}|\\s*>|\\s*-\\s+|\\s*\\d+\\.|=|\\+|-|_|\\*|#|\\s*\\[[^\n]]+\\]:)";c.unwrap=function(t){var s=new l("([^\\n])\\n(?!(\\n|"+c.prefixes+"))","g");t.selection=t.selection.replace(s,"$1 $2")};c.wrap=function(u,t){c.unwrap(u);var s=new l("(.{1,"+t+"})( +|$\\n?)","gm");u.selection=u.selection.replace(s,function(w,v){if(new l("^"+c.prefixes,"").test(w)){return w}return v+"\n"});u.selection=u.selection.replace(/\s+$/,"")};c.doBold=function(t,s){return c.doBorI(t,s,2,"strong text")};c.doItalic=function(t,s){return c.doBorI(t,s,1,"emphasized text")};c.doBorI=function(x,w,v,A){x.trimWhitespace();x.selection=x.selection.replace(/\n{2,}/g,"\n");x.before.search(/(\**$)/);var t=l.$1;x.after.search(/(^\**)/);var s=l.$1;var u=Math.min(t.length,s.length);if((u>=v)&&(u!=2||v!=1)){x.before=x.before.replace(l("[*]{"+v+"}$",""),"");x.after=x.after.replace(l("^[*]{"+v+"}",""),"")}else{if(!x.selection&&s){x.after=x.after.replace(/^([*_]*)/,"");x.before=x.before.replace(/(\s?)$/,"");var z=l.$1;x.before=x.before+s+z}else{if(!x.selection&&!s){x.selection=A}var y=v<=1?"*":"**";x.before=x.before+y;x.after=y+x.after}}return};c.stripLinkDefs=function(s,t){s=s.replace(/^[ ]{0,3}\[(\d+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|$)/gm,function(u,v,w,x,y){t[v]=u.replace(/\s*$/,"");if(x){t[v]=u.replace(/["(](.+?)[")]$/,"");return x+y}return""});return s};c.addLinkDef=function(x,u){var t=0;var A={};x.before=c.stripLinkDefs(x.before,A);x.selection=c.stripLinkDefs(x.selection,A);x.after=c.stripLinkDefs(x.after,A);var s="";var v=/(\[(?:\[[^\]]*\]|[^\[\]])*\][ ]?(?:\n[ ]*)?\[)(\d+)(\])/g;var w=function(B){t++;B=B.replace(/^[ ]{0,3}\[(\d+)\]:/,"  ["+t+"]:");s+="\n"+B};var z=function(D,E,C,B){if(A[C]){w(A[C]);return E+t+B}return D};x.before=x.before.replace(v,z);if(u){w(u)}else{x.selection=x.selection.replace(v,z)}var y=t;x.after=x.after.replace(v,z);if(x.after){x.after=x.after.replace(/\n*$/,"")}if(!x.after){x.selection=x.selection.replace(/\n*$/,"")}x.after+="\n\n"+s;return y};c.doLinkOrImage=function(u,t,s){u.trimWhitespace();u.findTags(/\s*!?\[/,/\][ ]?(?:\n[ ]*)?(\[.*?\])?/);if(u.endTag.length>1){u.startTag=u.startTag.replace(/!?\[/,"");u.endTag="";c.addLinkDef(u,null)}else{if(/\n\n/.test(u.selection)){c.addLinkDef(u,null);return}var v=function(y){if(y!==null){var w=window.location.protocol+"//"+window.location.hostname;if(y.toString().length>w.length&&y.toString().substring(0,w.length)==w){y=y.toString().substring(w.length,y.length)}if(y.toString().substring(0,4)!="http"&&y.toString().substring(0,1)!="/"){y="/"+y}u.startTag=u.endTag="";var z=" [999]: "+y;var x=c.addLinkDef(u,z);u.startTag=s?"![":"[";u.endTag="]["+x+"]";if(!u.selection){if(s){u.selection="alt text"}else{u.selection="link text"}}}t()};if(s){j.prompt(i,e,v)}else{j.prompt(q,k,v)}return true}};j.makeAPI=function(){m.wmd={};m.wmd.editor=m.editor;m.wmd.previewManager=m.previewManager};j.startEditor=function(){if(m.wmd_env.autostart===false){j.makeAPI();return}var t;var s;var u=function(){m.panels=new m.PanelCollection();s=new m.previewManager();var v=s.refresh;t=new m.editor(v);s.refresh(true)};j.addEvent(top,"load",u)};m.previewManager=function(){var J=this;var y;var B;var C;var z;var s;var v;var u=3000;var H="delayed";var F=function(K,L){j.addEvent(K,"input",L);K.onpaste=L;K.ondrop=L;j.addEvent(K,"keypress",L);j.addEvent(K,"keydown",L);B=new m.inputPoller(L,h)};var w=function(){var K=0;if(top.innerHeight){K=top.pageYOffset}else{if(d.documentElement&&d.documentElement.scrollTop){K=d.documentElement.scrollTop}else{if(d.body){K=d.body.scrollTop}}}return K};var D=function(){if(!m.panels.preview&&!m.panels.output){return}var M=m.panels.input.value;if(M&&M==s){return}else{s=M}var L=new Date().getTime();if(!y&&m.showdown){y=new m.showdown.converter()}if(y){M=y.makeHtml(M)}var K=new Date().getTime();z=K-L;t(M);v=M};var I=function(){if(C){top.clearTimeout(C);C=undefined}if(H!=="manual"){var K=0;if(H==="delayed"){K=z}if(K>u){K=u}C=top.setTimeout(D,K)}};var G=function(K){if(K.scrollHeight<=K.clientHeight){return 1}return K.scrollTop/(K.scrollHeight-K.clientHeight)};var x=function(){if(m.panels.preview){m.panels.preview.scrollTop=(m.panels.preview.scrollHeight-m.panels.preview.clientHeight)*G(m.panels.preview)}if(m.panels.output){m.panels.output.scrollTop=(m.panels.output.scrollHeight-m.panels.output.clientHeight)*G(m.panels.output)}};this.refresh=function(K){if(K){s="";D()}else{I()}};this.processingTime=function(){return z};this.output=function(){return v};this.setUpdateMode=function(K){H=K;J.refresh()};var A=true;var t=function(N){var K=p.getTop(m.panels.input)-w();if(m.panels.output){if(m.panels.output.value!==undefined){m.panels.output.value=N;m.panels.output.readOnly=true}else{var M=N.replace(/&/g,"&amp;");M=M.replace(/</g,"&lt;");m.panels.output.innerHTML="<pre><code>"+M+"</code></pre>"}}if(m.panels.preview){m.panels.preview.innerHTML=N}x();if(A){A=false;return}var L=p.getTop(m.panels.input)-w();if(a.isIE){top.setTimeout(function(){top.scrollBy(0,L-K)},0)}else{top.scrollBy(0,L-K)}};var E=function(){if(m.panels.input==null){return}F(m.panels.input,I);D();if(m.panels.preview){m.panels.preview.scrollTop=0}if(m.panels.output){m.panels.output.scrollTop=0}};this.destroy=function(){if(B){B.destroy()}};E()};c.doAutoindent=function(t,s){t.before=t.before.replace(/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]*\n$/,"\n\n");t.before=t.before.replace(/(\n|^)[ ]{0,3}>[ \t]*\n$/,"\n\n");t.before=t.before.replace(/(\n|^)[ \t]+\n$/,"\n\n");if(/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]+.*\n$/.test(t.before)){if(c.doList){c.doList(t)}}if(/(\n|^)[ ]{0,3}>[ \t]+.*\n$/.test(t.before)){if(c.doBlockquote){c.doBlockquote(t)}}if(/(\n|^)(\t|[ ]{4,}).*\n$/.test(t.before)){if(c.doCode){c.doCode(t)}}};c.doBlockquote=function(u,t){u.selection=u.selection.replace(/^(\n*)([^\r]+?)(\n*)$/,function(y,v,w,x){u.before+=v;u.after=x+u.after;return w});u.before=u.before.replace(/(>[ \t]*)$/,function(v,w){u.selection=w+u.selection;return""});u.selection=u.selection.replace(/^(\s|>)+$/,"");u.selection=u.selection||"Blockquote";if(u.before){u.before=u.before.replace(/\n?$/,"\n")}if(u.after){u.after=u.after.replace(/^\n?/,"\n")}u.before=u.before.replace(/(((\n|^)(\n[ \t]*)*>(.+\n)*.*)+(\n[ \t]*)*$)/,function(v){u.startTag=v;return""});u.after=u.after.replace(/^(((\n|^)(\n[ \t]*)*>(.+\n)*.*)+(\n[ \t]*)*)/,function(v){u.endTag=v;return""});var s=function(w){var v=w?"> ":"";if(u.startTag){u.startTag=u.startTag.replace(/\n((>|\s)*)\n$/,function(x,y){return"\n"+y.replace(/^[ ]{0,3}>?[ \t]*$/gm,v)+"\n"})}if(u.endTag){u.endTag=u.endTag.replace(/^\n((>|\s)*)\n/,function(x,y){return"\n"+y.replace(/^[ ]{0,3}>?[ \t]*$/gm,v)+"\n"})}};if(/^(?![ ]{0,3}>)/m.test(u.selection)){c.wrap(u,m.wmd_env.lineLength-2);u.selection=u.selection.replace(/^/gm,"> ");s(true);u.skipLines()}else{u.selection=u.selection.replace(/^[ ]{0,3}> ?/gm,"");c.unwrap(u);s(false);if(!/^(\n|^)[ ]{0,3}>/.test(u.selection)&&u.startTag){u.startTag=u.startTag.replace(/\n{0,2}$/,"\n\n")}if(!/(\n|^)[ ]{0,3}>.*$/.test(u.selection)&&u.endTag){u.endTag=u.endTag.replace(/^\n{0,2}/,"\n\n")}}if(!/\n/.test(u.selection)){u.selection=u.selection.replace(/^(> *)/,function(w,v){u.startTag+=v;return""})}};c.doCode=function(w,v){var x=/\S[ ]*$/.test(w.before);var t=/^[ ]*\S/.test(w.after);if((!t&&!x)||/\n/.test(w.selection)){w.before=w.before.replace(/[ ]{4}$/,function(y){w.selection=y+w.selection;return""});var u=1;var s=1;if(/\n(\t|[ ]{4,}).*\n$/.test(w.before)){u=0}if(/^\n(\t|[ ]{4,})/.test(w.after)){s=0}w.skipLines(u,s);if(!w.selection){w.startTag="    ";w.selection="enter code here"}else{if(/^[ ]{0,3}\S/m.test(w.selection)){w.selection=w.selection.replace(/^/gm,"    ")}else{w.selection=w.selection.replace(/^[ ]{4}/gm,"")}}}else{w.trimWhitespace();w.findTags(/`/,/`/);if(!w.startTag&&!w.endTag){w.startTag=w.endTag="`";if(!w.selection){w.selection="enter code here"}}else{if(w.endTag&&!w.startTag){w.before+=w.endTag;w.endTag=""}else{w.startTag=w.endTag=""}}}};c.doList=function(F,A,x){var E=/(\n|^)(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*$/;var B=/^\n*(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*/;var t="-";var s=1;var y=function(){var G;if(x){G=" "+s+". ";s++}else{G=" "+t+" "}return G};var C=function(G){if(x===undefined){x=/^\s*\d/.test(G)}G=G.replace(/^[ ]{0,3}([*+-]|\d+[.])\s/gm,function(H){return y()});return G};F.findTags(/(\n|^)*[ ]{0,3}([*+-]|\d+[.])\s+/,null);if(F.before&&!/\n$/.test(F.before)&&!/^\n/.test(F.startTag)){F.before+=F.startTag;F.startTag=""}if(F.startTag){var D=/\d+[.]/.test(F.startTag);F.startTag="";F.selection=F.selection.replace(/\n[ ]{4}/g,"\n");c.unwrap(F);F.skipLines();if(D){F.after=F.after.replace(B,C)}if(x==D){return}}var z=1;F.before=F.before.replace(E,function(G){if(/^\s*([*+-])/.test(G)){t=l.$1}z=/[^\n]\n\n[^\n]/.test(G)?1:0;return C(G)});if(!F.selection){F.selection="List item"}var u=y();var w=1;F.after=F.after.replace(B,function(G){w=/[^\n]\n\n[^\n]/.test(G)?1:0;return C(G)});F.trimWhitespace(true);F.skipLines(z,w,true);F.startTag=u;var v=u.replace(/./g," ");c.wrap(F,m.wmd_env.lineLength-v.length);F.selection=F.selection.replace(/\n/g,"\n"+v)};c.doHeading=function(w,v){w.selection=w.selection.replace(/\s+/g," ");w.selection=w.selection.replace(/(^\s+|\s+$)/g,"");if(!w.selection){w.startTag="## ";w.selection="Heading";w.endTag=" ##";return}var x=0;w.findTags(/#+[ ]*/,/[ ]*#+/);if(/#+/.test(w.startTag)){x=l.lastMatch.length}w.startTag=w.endTag="";w.findTags(null,/\s?(-+|=+)/);if(/=+/.test(w.endTag)){x=1}if(/-+/.test(w.endTag)){x=2}w.startTag=w.endTag="";w.skipLines(1,1);var s=x==0?2:x-1;if(s>0){var t=s>=2?"-":"=";var u=w.selection.length;if(u>m.wmd_env.lineLength){u=m.wmd_env.lineLength}w.endTag="\n";while(u--){w.endTag+=t}}};c.doHorizontalRule=function(t,s){t.startTag="----------\n";t.selection="";t.skipLines(2,1,true)}};function initializeWmd(){Attacklab.wmd_env={};Attacklab.account_options={};Attacklab.wmd_defaults={version:1,output:"Markdown",lineLength:40,delayLoad:false};if(!Attacklab.wmd){Attacklab.wmd=function(){Attacklab.loadEnv=function(){var b=function(d){if(!d){return}for(var c in d){Attacklab.wmd_env[c]=d[c]}};b(Attacklab.wmd_defaults);b(Attacklab.account_options);b(top.wmd_options);Attacklab.full=true;var a="bold italic link blockquote code image ol ul heading hr";Attacklab.wmd_env.buttons=Attacklab.wmd_env.buttons||a};Attacklab.loadEnv()};Attacklab.wmd();Attacklab.wmdBase();Attacklab.Util.startEditor()}};